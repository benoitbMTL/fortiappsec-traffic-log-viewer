<!doctype html>
<html lang="en">

<head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FortiAppSec Traffic Logs</title>
  <link rel="icon" href="/static/favicon.ico">

  <!-- Tabulator + Bootstrap5 theme -->
  <link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator_bootstrap5.min.css" rel="stylesheet">
  <script src="https://unpkg.com/tabulator-tables@6.3.1/dist/js/tabulator.min.js" defer
    onerror="window.__TABULATOR_FAILED__=true;"></script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" defer></script>

  <!-- Bootstrap Icons (for small "x" in column headers) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Style CSS -->
  <link href="/static/css/style.css" rel="stylesheet">

  <!-- Flag icons CSS (required) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">

  <!-- Scripts -->
  <script src="/static/js/country-flags.js"></script>
  <script src="/static/js/app.js"></script>


</head>

<!-- ================== POP-UP CONFIG (Modal) ================== -->
<div class="modal fade" id="configModal" tabindex="-1" aria-labelledby="configModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header py-2">
        <h6 class="modal-title" id="configModalLabel">Azure blob configuration</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btnCfgXClose"></button>
      </div>

      <div class="modal-body">
        <!-- Timezone -->
        <div class="mb-3">
          <label for="cfgTimezone" class="form-label small">Timezone (IANA)</label>
          <input id="cfgTimezone" class="form-control form-control-sm" type="text" list="tzList"
            placeholder="Type to search…">
          <datalist id="tzList"></datalist>
          <div class="form-text">Used to render timestamps in the table.</div>
        </div>


        <!-- Storage Account Name -->
        <div class="mb-3">
          <label for="cfgAccount" class="form-label small">Storage Account Name</label>
          <input id="cfgAccount" class="form-control form-control-sm" type="text" autocomplete="off" />
        </div>

        <!-- Account Access Key (hidden) -->
        <div class="mb-3">
          <label for="cfgKey" class="form-label small">Account Access Key</label>
          <input id="cfgKey" class="form-control form-control-sm" type="password" autocomplete="new-password" />
        </div>

        <!-- Container Name -->
        <div class="mb-3">
          <label for="cfgContainer" class="form-label small">Container Name</label>
          <input id="cfgContainer" class="form-control form-control-sm" type="text" autocomplete="off" />
        </div>

        <!-- Fetch controls -->
        <div class="mb-3">
          <label for="cfgFetchRange" class="form-label small">Fetch Range</label>
          <select id="cfgFetchRange" class="form-select form-select-sm">
            <option value="unlimited">Unlimited</option>
            <option value="last_hour">Last hour</option>
            <option value="last_day">Last 24 hours</option>
            <option value="last_week">Last 7 days</option>
            <option value="last_month">Last 30 days</option>
            <option value="custom">Custom (UTC range)</option>
          </select>

          <div id="customRangeRow" class="row g-2 mt-1" style="display:none;">
            <div class="col-6">
              <label for="cfgStartUtc" class="form-label small">Start (UTC)</label>
              <input id="cfgStartUtc" type="datetime-local" class="form-control form-control-sm" />
            </div>
            <div class="col-6">
              <label for="cfgEndUtc" class="form-label small">End (UTC)</label>
              <input id="cfgEndUtc" type="datetime-local" class="form-control form-control-sm" />
            </div>
          </div>
        </div>

        <div class="mb-2">
          <label for="cfgMaxBlobs" class="form-label small">Max Rows (0 = unlimited)</label>
          <input id="cfgMaxBlobs" class="form-control form-control-sm" type="number" min="0" step="1" value="0" />
        </div>

        <!-- Test Result -->
        <div id="cfgAlert" class="mt-2"></div>

      </div>



      <div class="modal-footer py-2">
        <!-- Required actions -->
        <button id="btnCfgDefault" type="button" class="btn btn-outline-primary btn-sm">Default</button>
        <button id="btnCfgTest" type="button" class="btn btn-success btn-sm">Test</button>
        <button id="btnCfgSave" type="button" class="btn btn-primary btn-sm">Save</button>
        <button type="button" class="btn btn-light btn-sm" data-bs-dismiss="modal" id="btnCfgClose">Close</button>
      </div>
    </div>
  </div>
</div>







<body class="bg-light d-flex flex-column min-vh-100">

  <!-- ===== NAVBAR ===== -->
  <!-- py-1 to reduce overall navbar height -->
  <nav class="navbar bg-body-tertiary py-1 border-bottom">
    <div class="container-fluid">

      <!-- Line 1: Title + counters -->
      <div class="d-flex w-100 align-items-center justify-content-between flex-wrap gap-2 mb-1">
        <a class="navbar-brand py-0 m-0" href="#"><strong>FortiAppSec Traffic Logs</strong></a>
        <div class="d-flex align-items-center gap-2">
          <span class="navbar-text small">
            <span class="badge text-bg-light border">Rows: <strong id="count">-</strong></span>
          </span>
          <span class="navbar-text small">
            <span class="badge text-bg-light border">Last load (UTC): <strong id="last">-</strong></span>
          </span>
          <button id="reloadBtn" class="badge text-bg-dark border-0">Reload from Azure</button>
        </div>
      </div>

      <!-- Line 2: Left (Columns) | Center (Quick Filter) | Right (Exports) -->
      <!-- IMPORTANT: no justify-content-between here; we use three clusters with the center truly centered -->
      <div class="d-flex w-100 align-items-center flex-wrap gap-2 mb-2">
        <!-- Left cluster: Columns dropdown -->
        <div class="dropdown">
          <button id="openColDropdown" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
            data-bs-auto-close="outside">
            Columns
          </button>
          <div id="colDropdown" class="dropdown-menu p-2" style="min-width:280px;max-height:60vh;overflow:auto;">
            <div class="d-flex gap-2 mb-2">
              <button type="button" class="btn btn-outline-dark btn-sm" id="colAll">All</button>
              <button type="button" class="btn btn-outline-dark btn-sm" id="colNone">None</button>
              <button type="button" class="btn btn-outline-primary btn-sm" id="colDefault">Default</button>
            </div>
            <div id="colList" class="d-flex flex-column gap-1 small"></div>
          </div>
        </div>

        <!-- Center cluster: true center thanks to flex-grow-1 + justify-content-center -->
        <div class="flex-grow-1 d-flex justify-content-center">
          <form class="d-flex align-items-center gap-2" role="search" onsubmit="return false;">
            <input id="quickFilter" class="form-control form-control-sm" type="search" placeholder="Quick filter…"
              aria-label="Search" style="width:300px;">
            <button id="clearFilter" class="btn btn-primary btn-sm" type="button">Clear</button>
          </form>
        </div>



        <!-- Export buttons + Config -->
        <div class="d-flex align-items-center gap-2 ms-auto">
          <a class="btn btn-outline-dark btn-sm" href="/data.csv" target="_blank">Export CSV</a>
          <a class="btn btn-outline-dark btn-sm" href="/data.json" target="_blank">Export JSON</a>

          <!-- New: Config button opens the modal -->
          <button id="btnOpenConfig" class="btn btn-outline-primary btn-sm" type="button" data-bs-toggle="modal"
            data-bs-target="#configModal">
            Config
          </button>
        </div>




      </div>
    </div>
  </nav>

  <!-- Error banner -->
  <div id="errorBanner" class="alert alert-danger d-none rounded-0 mb-0" role="alert"></div>

  <!-- Table area -->
  <main class="flex-grow-1 d-flex flex-column">
    <div class="container-fluid py-3 flex-grow-1">
      <div id="tableCard" class="card shadow-sm rounded-3 h-100">
        <!-- p-1 to reduce vertical padding in the card that contains the table -->
        <div class="card-body p-1 d-flex flex-column">
          <div id="table" class="tabulator bootstrap5 flex-grow-1"></div>
        </div>
      </div>
    </div>
  </main>
</body>

</html>